<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>NCERT Quiz</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --saffron: #FF6B00;
    --deep-saffron: #E55A00;
    --gold: #FFB300;
    --white: #FFFDF7;
    --dark: #1A1A2E;
    --radius: 16px;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Baloo 2', 'Noto Sans Devanagari', sans-serif;
    background: linear-gradient(135deg, #FFF8F0 0%, #FFF3E0 100%);
    min-height: 100vh;
    color: var(--dark);
  }
  .header {
    background: linear-gradient(135deg, var(--saffron), #FF8C00, var(--gold));
    padding: 16px;
    text-align: center;
  }
  .header h1 { color: white; font-size: 20px; font-weight: 800; }
  .header p { color: rgba(255,255,255,0.9); font-size: 11px; margin-top: 2px; }
  .subject-tabs {
    display: flex; gap: 8px; padding: 10px 12px;
    overflow-x: auto; scrollbar-width: none;
    background: white; border-bottom: 2px solid #F0E6D3;
  }
  .subject-tabs::-webkit-scrollbar { display: none; }
  .tab-btn {
    flex-shrink: 0; padding: 7px 14px; border: none;
    border-radius: 20px; font-family: inherit; font-size: 13px;
    font-weight: 600; cursor: pointer; background: #F5F5F5; color: #666;
    border: 2px solid transparent; transition: all 0.2s;
  }
  .tab-btn.active {
    background: var(--saffron); color: white;
    border-color: var(--deep-saffron); box-shadow: 0 3px 10px rgba(255,107,0,0.3);
  }
  .class-row {
    display: flex; gap: 6px; padding: 8px 12px;
    overflow-x: auto; scrollbar-width: none;
    background: white; border-bottom: 1px solid #F0E6D3;
  }
  .class-row::-webkit-scrollbar { display: none; }
  .class-btn {
    flex-shrink: 0; padding: 4px 12px; border: 2px solid #DDD;
    border-radius: 12px; font-family: inherit; font-size: 12px;
    font-weight: 600; cursor: pointer; background: white; color: #888;
    transition: all 0.2s;
  }
  .class-btn.active { border-color: #0D47A1; background: #E3F2FD; color: #0D47A1; }
  .stats-bar {
    display: flex; justify-content: space-around;
    padding: 8px 16px; background: white; border-bottom: 1px solid #F0E6D3;
  }
  .stat { text-align: center; }
  .stat-val { font-size: 18px; font-weight: 800; color: var(--saffron); line-height: 1; }
  .stat-val.green { color: #2E7D32; }
  .stat-val.red { color: #C62828; }
  .stat-label { font-size: 10px; color: #888; margin-top: 2px; }
  .main { padding: 12px; max-width: 600px; margin: 0 auto; }
  .question-card {
    background: white; border-radius: var(--radius); padding: 16px;
    margin-bottom: 12px; box-shadow: 0 4px 20px rgba(255,107,0,0.15);
    border-left: 5px solid var(--saffron); animation: slideIn 0.3s ease;
  }
  @keyframes slideIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
  .q-meta { display: flex; justify-content: space-between; margin-bottom: 10px; }
  .q-badge {
    background: #FFF3CD; color: #8B6914; font-size: 11px;
    font-weight: 700; padding: 3px 10px; border-radius: 20px; border: 1px solid #FFD54F;
  }
  .q-exam-tag {
    background: #E8EAF6; color: #3949AB; font-size: 10px;
    font-weight: 600; padding: 3px 8px; border-radius: 10px;
  }
  .q-text-hi {
    font-size: 15px; font-weight: 700; color: var(--dark);
    line-height: 1.6; margin-bottom: 6px; font-family: 'Noto Sans Devanagari', sans-serif;
  }
  .q-text-en {
    font-size: 12px; color: #555; line-height: 1.5; font-style: italic;
    margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px dashed #EEE;
  }
  .options { display: flex; flex-direction: column; gap: 8px; }
  .option-btn {
    display: flex; align-items: center; gap: 10px; padding: 10px 14px;
    border: 2px solid #E8E8E8; border-radius: 12px; background: #FAFAFA;
    cursor: pointer; transition: all 0.2s; text-align: left;
    font-family: inherit; width: 100%;
  }
  .option-btn:hover:not(:disabled) { border-color: var(--saffron); background: #FFF5EC; transform: translateX(3px); }
  .opt-letter {
    width: 28px; height: 28px; border-radius: 50%; background: #F0F0F0;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 800; flex-shrink: 0; color: #666;
  }
  .opt-text-hi { font-size: 13px; font-weight: 600; color: var(--dark); font-family: 'Noto Sans Devanagari', sans-serif; }
  .opt-text-en { font-size: 11px; color: #888; font-style: italic; }
  .option-btn.correct { border-color: #2E7D32; background: linear-gradient(135deg, #E8F5E9, #C8E6C9); }
  .option-btn.correct .opt-letter { background: #2E7D32; color: white; }
  .option-btn.wrong { border-color: #C62828; background: linear-gradient(135deg, #FFEBEE, #FFCDD2); }
  .option-btn.wrong .opt-letter { background: #C62828; color: white; }
  .option-btn.reveal-correct { border-color: #2E7D32; background: #E8F5E9; opacity: 0.8; }
  .explanation {
    margin-top: 12px; padding: 12px;
    background: linear-gradient(135deg, #FFF8E1, #FFF3CD);
    border-radius: 10px; border-left: 4px solid var(--gold);
  }
  .exp-title { font-size: 12px; font-weight: 700; color: #7B5800; margin-bottom: 6px; }
  .exp-text { font-size: 13px; color: #5D4037; line-height: 1.6; font-family: 'Noto Sans Devanagari', sans-serif; }
  .exp-text-en { font-size: 11px; color: #795548; font-style: italic; margin-top: 4px; }
  .next-btn {
    width: 100%; padding: 14px;
    background: linear-gradient(135deg, var(--saffron), var(--deep-saffron));
    color: white; border: none; border-radius: 14px; font-family: inherit;
    font-size: 16px; font-weight: 800; cursor: pointer; margin-top: 10px;
    box-shadow: 0 4px 15px rgba(255,107,0,0.35); display: none;
  }
  .next-btn.visible { display: block; }
  .loading-card {
    background: white; border-radius: var(--radius); padding: 40px 20px;
    text-align: center; box-shadow: 0 4px 20px rgba(255,107,0,0.15);
  }
  .loader {
    display: inline-block; width: 40px; height: 40px;
    border: 4px solid #FFE0CC; border-top-color: var(--saffron);
    border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 16px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { color: var(--saffron); font-size: 15px; font-weight: 700; }
  .error-card {
    background: #FFF3E0; border-radius: var(--radius); padding: 20px;
    text-align: center; border: 2px solid #FFB300; display: none;
  }
  .error-card.visible { display: block; }
  .retry-btn {
    margin-top: 12px; padding: 10px 24px; background: var(--saffron);
    color: white; border: none; border-radius: 10px; font-family: inherit;
    font-size: 14px; font-weight: 700; cursor: pointer;
  }
  .premium-banner {
    background: linear-gradient(135deg, #1A1A2E, #0D47A1); color: white;
    padding: 8px 16px; display: flex; align-items: center; justify-content: space-between; font-size: 11px;
  }
  .premium-btn {
    background: var(--gold); color: #333; border: none; padding: 4px 12px;
    border-radius: 20px; font-family: inherit; font-size: 11px; font-weight: 700; cursor: pointer;
  }
</style>
</head>
<body>
<div class="header">
  <h1>üéØ NCERT ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ Quiz</h1>
  <p>‡§ï‡§ï‡•ç‡§∑‡§æ 6-12 | ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‚Ä¢ ‡§≠‡•Ç‡§ó‡•ã‡§≤ ‚Ä¢ ‡§Ö‡§∞‡•ç‡§•‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‚Ä¢ ‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø</p>
</div>

<div class="subject-tabs">
  <button class="tab-btn active" onclick="setSubject(this,'‡§á‡§§‡§ø‡§π‡§æ‡§∏')">‚öîÔ∏è ‡§á‡§§‡§ø‡§π‡§æ‡§∏</button>
  <button class="tab-btn" onclick="setSubject(this,'‡§≠‡•Ç‡§ó‡•ã‡§≤')">üåç ‡§≠‡•Ç‡§ó‡•ã‡§≤</button>
  <button class="tab-btn" onclick="setSubject(this,'‡§Ö‡§∞‡•ç‡§•‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞')">üìà ‡§Ö‡§∞‡•ç‡§•‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞</button>
  <button class="tab-btn" onclick="setSubject(this,'‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞')">üèõÔ∏è ‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø</button>
  <button class="tab-btn" onclick="setSubject(this,'‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§')">üé≤ ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§</button>
</div>

<div class="class-row">
  <button class="class-btn active" onclick="setClass(this,'all')">‡§∏‡§≠‡•Ä</button>
  <button class="class-btn" onclick="setClass(this,'6')">6th</button>
  <button class="class-btn" onclick="setClass(this,'7')">7th</button>
  <button class="class-btn" onclick="setClass(this,'8')">8th</button>
  <button class="class-btn" onclick="setClass(this,'9')">9th</button>
  <button class="class-btn" onclick="setClass(this,'10')">10th</button>
  <button class="class-btn" onclick="setClass(this,'11')">11th</button>
  <button class="class-btn" onclick="setClass(this,'12')">12th</button>
</div>

<div class="stats-bar">
  <div class="stat"><div class="stat-val" id="totalCount">0</div><div class="stat-label">‡§ï‡•Å‡§≤</div></div>
  <div class="stat"><div class="stat-val green" id="correctCount">0</div><div class="stat-label">‡§∏‡§π‡•Ä ‚úì</div></div>
  <div class="stat"><div class="stat-val red" id="wrongCount">0</div><div class="stat-label">‡§ó‡§≤‡§§ ‚úó</div></div>
  <div class="stat"><div class="stat-val" id="streakCount">0üî•</div><div class="stat-label">‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ï</div></div>
</div>

<div class="premium-banner">
  <span>‚ú® Premium: Unlimited MCQs + PDF Notes</span>
  <button class="premium-btn" onclick="showPremium()">‚Çπ99/‡§Æ‡§æ‡§π</button>
</div>

<div class="main">
  <div class="loading-card" id="loadingCard">
    <div class="loader"></div>
    <div class="loading-text">‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
  </div>
  <div class="error-card" id="errorCard">
    <div style="font-size:36px">‚ö†Ô∏è</div>
    <div style="font-weight:700;margin:8px 0">‡§ï‡•Å‡§õ ‡§ó‡§°‡§º‡§¨‡§°‡§º ‡§π‡•Å‡§à</div>
    <div style="font-size:13px;color:#666" id="errorMsg"></div>
    <button class="retry-btn" onclick="loadQuestion()">üîÑ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂</button>
  </div>
  <div class="question-card" id="questionCard" style="display:none">
    <div class="q-meta">
      <span class="q-badge" id="qBadge">‡§ï‡§ï‡•ç‡§∑‡§æ 6 | ‡§á‡§§‡§ø‡§π‡§æ‡§∏</span>
      <span class="q-exam-tag" id="qExamTag">SSC/UPSC</span>
    </div>
    <div class="q-text-hi" id="qTextHi"></div>
    <div class="q-text-en" id="qTextEn"></div>
    <div class="options" id="optionsContainer"></div>
    <div class="explanation" id="explanation" style="display:none">
      <div class="exp-title">üí° ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ | Explanation</div>
      <div class="exp-text" id="expTextHi"></div>
      <div class="exp-text-en" id="expTextEn"></div>
    </div>
    <button class="next-btn" id="nextBtn" onclick="loadQuestion()">‡§Ö‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‚Üí Next Question</button>
  </div>
</div>

<script>
// GEMINI API KEY - ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä key ‡§π‡•à
const GEMINI_API_KEY = "AIzaSyAKji440cnc0OVu9A0SbWSKkFFbPR54viI";

let currentSubject = '‡§á‡§§‡§ø‡§π‡§æ‡§∏';
let currentClass = 'all';
let stats = { total: 0, correct: 0, wrong: 0, streak: 0 };
let currentQuestion = null;
let answered = false;

if (window.Telegram && window.Telegram.WebApp) {
  window.Telegram.WebApp.ready();
  window.Telegram.WebApp.expand();
}

window.onload = () => loadQuestion();

function setSubject(btn, subject) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentSubject = subject;
  if (!answered) loadQuestion();
}

function setClass(btn, cls) {
  document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentClass = cls;
  if (!answered) loadQuestion();
}

async function loadQuestion() {
  answered = false;
  document.getElementById('nextBtn').classList.remove('visible');
  document.getElementById('questionCard').style.display = 'none';
  document.getElementById('errorCard').classList.remove('visible');
  document.getElementById('loadingCard').style.display = 'block';
  try {
    const q = await generateQuestion();
    displayQuestion(q);
  } catch(err) {
    document.getElementById('loadingCard').style.display = 'none';
    document.getElementById('errorCard').classList.add('visible');
    document.getElementById('errorMsg').textContent = err.message;
  }
}

async function generateQuestion() {
  const classText = currentClass === 'all' ? '‡§ï‡§ï‡•ç‡§∑‡§æ 6 ‡§∏‡•á 12' : `‡§ï‡§ï‡•ç‡§∑‡§æ ${currentClass}`;
  const seed = Math.floor(Math.random() * 9999);
  const prompt = `You are NCERT expert. Create 1 MCQ from NCERT ${currentSubject} ${classText} asked in UPSC/SSC/Railway exam.
Return ONLY valid JSON:
{
  "class": "‡§ï‡§ï‡•ç‡§∑‡§æ 9",
  "exam_tag": "SSC 2022",
  "q_hi": "‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®",
  "q_en": "English question",
  "options": [
    {"letter": "A", "hi": "‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ A", "en": "Option A"},
    {"letter": "B", "hi": "‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ B", "en": "Option B"},
    {"letter": "C", "hi": "‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ C", "en": "Option C"},
    {"letter": "D", "hi": "‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ D", "en": "Option D"}
  ],
  "correct": "B",
  "exp_hi": "‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç",
  "exp_en": "Explanation in English"
}
Seed:${seed}`;

  const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ parts: [{ text: prompt }] }],
      generationConfig: { temperature: 0.9, maxOutputTokens: 1000 }
    })
  });

  if (!response.ok) throw new Error('API Error: ' + response.status);
  const data = await response.json();
  const text = data.candidates[0].content.parts[0].text;
  const match = text.match(/\{[\s\S]*\}/);
  if (!match) throw new Error('JSON parse error');
  return JSON.parse(match[0]);
}

function displayQuestion(q) {
  currentQuestion = q;
  document.getElementById('loadingCard').style.display = 'none';
  document.getElementById('questionCard').style.display = 'block';
  document.getElementById('explanation').style.display = 'none';
  document.getElementById('qBadge').textContent = `${q.class} | ${currentSubject}`;
  document.getElementById('qExamTag').textContent = q.exam_tag || 'UPSC/SSC';
  document.getElementById('qTextHi').textContent = q.q_hi;
  document.getElementById('qTextEn').textContent = q.q_en;
  const container = document.getElementById('optionsContainer');
  container.innerHTML = '';
  q.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.innerHTML = `<div class="opt-letter">${opt.letter}</div><div class="opt-text"><div class="opt-text-hi">${opt.hi}</div><div class="opt-text-en">${opt.en}</div></div>`;
    btn.onclick = () => selectAnswer(opt.letter, q.correct, btn);
    container.appendChild(btn);
  });
}

function selectAnswer(selected, correct, clickedBtn) {
  if (answered) return;
  answered = true;
  stats.total++;
  document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
  if (selected === correct) {
    clickedBtn.classList.add('correct');
    stats.correct++;
    stats.streak++;
    if (window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
  } else {
    clickedBtn.classList.add('wrong');
    stats.wrong++;
    stats.streak = 0;
    document.querySelectorAll('.option-btn').forEach(btn => {
      if (btn.querySelector('.opt-letter').textContent === correct) btn.classList.add('reveal-correct');
    });
    if (window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
  }
  document.getElementById('totalCount').textContent = stats.total;
  document.getElementById('correctCount').textContent = stats.correct;
  document.getElementById('wrongCount').textContent = stats.wrong;
  document.getElementById('streakCount').textContent = stats.streak + 'üî•';
  document.getElementById('expTextHi').textContent = currentQuestion.exp_hi;
  document.getElementById('expTextEn').textContent = currentQuestion.exp_en;
  document.getElementById('explanation').style.display = 'block';
  document.getElementById('nextBtn').classList.add('visible');
}

function showPremium() {
  alert('üåü Premium Plan\n\n‚úÖ Unlimited MCQs\n‚úÖ Chapter-wise Test Series\n‚úÖ PDF Notes\n‚úÖ Daily Challenge\n\n‚Çπ99/‡§Æ‡§æ‡§π | ‚Çπ699/‡§∏‡§æ‡§≤\n\nContact: @your_username');
}
</script>
</body>
</html>
